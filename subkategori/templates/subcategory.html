{% extends "base.html" %}
{% load static %}
{% load humanize %}
{% load currency_format %}
{% load rating_filters %}
{% block title %}{{ subcategory.nama_subkategori }}{% endblock %}
{% block content %}
{% include 'navbar.html' %}

<div class="subcategory-content">
    <div class="navigation">
        <div class="navigation-buttons">
            <button onclick="window.location.href='{% url 'main:show_home_page' %}'" class="navigation-button">
                <div class="home horizontal-stack-info">
                    <img src="https://www.svgrepo.com/show/500894/home.svg" alt="Home" style="width: 20px; height: 20px;">
                    <span>Home</span>
                </div>
            </button>
            <div class="path">
                <img src="https://www.svgrepo.com/show/521479/arrow-next-small.svg" alt="Arrow Next" style="width: 30px; height: 30px; padding-top:0.2rem; filter: invert(88%) sepia(6%) saturate(0%) hue-rotate(180deg) brightness(97%) contrast(87%);">
            </div>
            <button onclick="window.location.href='/subcategory/{{ subcategory.nama_subkategori|cut:" " }}'" class="navigation-button" style="cursor: pointer;">
                <div class="subcateg horizontal-stack-info">
                    {% if category.nama_kategori == 'Deep Cleaning' %}
                        <img src="https://www.svgrepo.com/show/490223/sofa.svg" alt="Deep Cleaning" style="margin-bottom: 2px; width: 15px; height: 15px;">
                    {% elif category.nama_kategori == 'Hair Care' %}
                        <img src="https://www.svgrepo.com/show/431704/hair.svg" alt="Hair Care" style="width: 20px; height: 20px;">
                    {% elif category.nama_kategori == 'Home Cleaning' %}
                        <img src="https://www.svgrepo.com/show/490589/broom-cleaning.svg" alt="Home Cleaning" style="width: 15px; height: 15px;">
                    {% elif category.nama_kategori == 'Massage' %}
                        <img src="https://www.svgrepo.com/show/220289/lotus-yoga.svg" alt="Massage" style="width: 15px; height: 15px;">
                    {% elif category.nama_kategori == 'Service AC' %}
                        <img src="https://www.svgrepo.com/show/503152/air-conditioner.svg" alt="Service AC" style="width: 20px; height: 20px;">
                    {% endif %}
                    <span>{{ category.nama_kategori }}</span>
                </div>
            </button>
            <div class="path">
                <img src="https://www.svgrepo.com/show/521479/arrow-next-small.svg" alt="Arrow Next" style="width: 30px; height: 30px; padding-top:0.2rem; filter: invert(88%) sepia(6%) saturate(0%) hue-rotate(180deg) brightness(97%) contrast(87%);">
            </div>
            <button onclick="window.location.href='/subcategory/{{ subcategory.nama_subkategori|cut:" " }}'" class="navigation-button" style="cursor: pointer;">
                <div class="subcateg-name horizontal-stack-info" style="color: #667a7b;">
                    {% if category.nama_kategori == 'Deep Cleaning' %}
                        <img src="https://www.svgrepo.com/show/490223/sofa.svg" alt="Deep Cleaning" style="margin-bottom: 2px; width: 15px; height: 15px; filter: invert(42%) sepia(9%) saturate(473%) hue-rotate(152deg) brightness(94%) contrast(87%);">
                    {% elif category.nama_kategori == 'Hair Care' %}
                        <img src="https://www.svgrepo.com/show/431704/hair.svg" alt="Hair Care" style="width: 20px; height: 20px; filter: invert(48%) sepia(9%) saturate(754%) hue-rotate(152deg) brightness(92%) contrast(87%);">
                    {% elif category.nama_kategori == 'Home Cleaning' %}
                        <img src="https://www.svgrepo.com/show/490589/broom-cleaning.svg" alt="Home Cleaning" style="width: 15px; height: 15px; filter: invert(42%) sepia(9%) saturate(473%) hue-rotate(152deg) brightness(94%) contrast(87%);">
                    {% elif category.nama_kategori == 'Massage' %}
                        <img src="https://www.svgrepo.com/show/220289/lotus-yoga.svg" alt="Massage" style="width: 15px; height: 15px; filter: invert(42%) sepia(9%) saturate(473%) hue-rotate(152deg) brightness(94%) contrast(87%);">
                    {% elif category.nama_kategori == 'Service AC' %}
                        <img src="https://www.svgrepo.com/show/503152/air-conditioner.svg" alt="Service AC" style="width: 20px; height: 20px; filter: invert(42%) sepia(9%) saturate(473%) hue-rotate(152deg) brightness(94%) contrast(87%);">
                    {% endif %}
                    <span>{{ subcategory.nama_subkategori }}</span>
                </div>
            </button>
        </div>
    </div>
    <div class="subcategory-container">
        <div class="subcategory-container-content">
            <div class="sub-info horizontal-stack-subcategory">
                <div class="subcategory-picture">
                    {% if subcategory.nama_subkategori == 'Cuci Kasur' %}
                        <img src="https://www.makeitclean.com.au/wp-content/uploads/2022/06/how-to-clean-a-mattress-featured.jpg" alt="Cuci Kasur">
                    {% elif subcategory.nama_subkategori == 'Cuci Sofa' %}
                        <img src="https://www.prosofaclean.com.au/wp-content/uploads/2021/06/Best-Sofa-Cleaner.jpg" alt="Cuci Sofa">
                    {% elif subcategory.nama_subkategori == 'Hair Coloring' %}
                        <img src="https://media.allure.com/photos/61bc9e2161450b343d3a87ac/master/pass/hair-dye-red-hair-treatment.jpg" alt="Hair Coloring">
                    {% elif subcategory.nama_subkategori == 'Hair Cut' %}
                        <img src="https://shelleyshairandspa.com/wp-content/uploads/2020/09/haircut.jpeg" alt="Hair Cut">
                    {% elif subcategory.nama_subkategori == 'Daily Cleaning' %}
                        <img src="https://cdn.prod.website-files.com/640051ce8a159067e1042e74/65d5b19950d874f282b5c35f_woman-with-gloves-cleaning-floor_23-2148520978.jpg" alt="Daily Cleaning">
                    {% elif subcategory.nama_subkategori == 'Setrika' %}
                        <img src="https://www.bredonhillcleaningservices.co.uk/wp-content/uploads/2020/07/shutterstock-238643320-cropped-1521537943-scaled.jpg" alt="Setrika">
                    {% elif subcategory.nama_subkategori == 'Balinese Massage' %}
                        <img src="https://finnsbeachclub.com/wp-content/uploads/2023/12/0512-0750_baligreenspa_indonesia_pelago14.jpg" alt="Balinese Massage">
                    {% elif subcategory.nama_subkategori == 'Swedish Massage' %}
                        <img src="https://palaisfrance.com/wp-content/uploads/2023/12/image-1.png" alt="Swedish Massage">
                    {% elif subcategory.nama_subkategori == 'Cuci AC' %}
                        <img src="https://img.choice.com.au/-/media/f12ceb8d12254788b1dff8a5f7377f80.ashx" alt="Cuci AC">
                    {% elif subcategory.nama_subkategori == 'Refill Freon' %}
                        <img src="https://www.checkatrade.com/blog/wp-content/uploads/2021/08/Feature-Freon-refill-cost.jpg" alt="Refill Freon">
                    {% endif %}
                </div>
                <div class="subcategory-main-info">
                    <div class="subcategory-name">
                        <h1>{{ subcategory.nama_subkategori }}</h1>
                    </div>
                    <div class="mini-infos">
                        <div class="mini-info">
                            {% if category.nama_kategori == 'Deep Cleaning' %}
                                <div class="category-info horizontal-stack-info">
                                    <img src="https://www.svgrepo.com/show/490223/sofa.svg" alt="Deep Cleaning" style="margin-bottom: 2px; width: 15px; height: 15px;">
                                </div>
                            {% elif category.nama_kategori == 'Hair Care' %}
                                <div class="category-info horizontal-stack-info">
                                    <img src="https://www.svgrepo.com/show/431704/hair.svg" alt="Hair Care" style="width: 20px; height: 20px; filter: brightness(0);">
                                </div>
                            {% elif category.nama_kategori == 'Home Cleaning' %}
                                <div class="category-info horizontal-stack-info">
                                    <img src="https://www.svgrepo.com/show/490589/broom-cleaning.svg" alt="Home Cleaning" style="width: 15px; height: 15px; filter: brightness(0);">
                                </div>
                            {% elif category.nama_kategori == 'Massage' %}
                                <div class="category-info horizontal-stack-info">
                                    <img src="https://www.svgrepo.com/show/220289/lotus-yoga.svg" alt="Massage" style="width: 15px; height: 15px; filter: brightness(0);">
                                </div>
                            {% elif category.nama_kategori == 'Service AC' %}
                                <div class="category-info horizontal-stack-info">
                                    <img src="https://www.svgrepo.com/show/503152/air-conditioner.svg" alt="Service AC" style="width: 20px; height: 20px; filter: brightness(0);">
                                </div>
                            {% endif %}
                            <span>{{ category.nama_kategori }}</span>
                        </div>
                    </div>
                    <div class="subcategory-description">
                        <span>Deskripsi: {{ subcategory.deskripsi }}</span>
                    </div>
                    {% if request.session.user_type == 'pekerja' %}
                    <div class = "p_buttons">
                        {% if not additional_attributes.is_enrolled %}
                            <button class="join-sub" onclick="window.location.href='{% url 'subkategori:enroll_subcategory' subcategory.nama_subkategori %}'">Gabung ke Subkategori</button>
                        {% else %}
                            <div class="enrolled-status">Sudah terdaftar di subkategori ini</div>
                        {% endif %}
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
        <div class="addts">
            <div class="session-container">
                <div class="session-card-header" onclick="toggleSessions(this)" style="cursor: pointer;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <strong>Pilihan Sesi Layanan</strong>
                        <img src="https://www.svgrepo.com/show/522029/chevron-down.svg" alt="Toggle" class="toggle-icon" style="width: 20px; height: 20px; filter: invert(100%);">
                    </div>
                </div>
                <div class="session-card-content">
                    <div class="sessions-grid">
                        {% for session in sessions %}
                            {% with row_start=forloop.counter0|default:0 %}
                            {% if row_start|divisibleby:3 %}
                                <div class="sessions-row">
                            {% endif %}
                            <div class="session-item">
                                <div class="session-info">
                                    <div class="session-number">{{ session.sesi }} Jam</div>
                                    <div class="session-price">{{ session.harga|currency_format }}</div>
                                </div>
                                {% if request.session.is_authenticated and request.session.user_type == 'pelanggan' %}
                                <div class = "p_buttons">
                                    <button class="order-session" onclick="{% if request.session.is_authenticated %}window.location.href='{% url 'pemesanan_jasa:order_form' subcategory.nama_subkategori|cut:' ' %}?sesi=' + encodeURIComponent(this.closest('.session-item').querySelector('.session-number').textContent.split(' ')[0]){% else %}window.location.href='{% url 'main:login_user' %}'{% endif %}">Pesan Jasa</button>
                                </div>
                                {% endif %}
                            </div>
                            {% if forloop.counter|divisibleby:3 or forloop.last %}
                                </div>
                            {% endif %}
                            {% endwith %}
                        {% empty %}
                            <div class="no-sessions">
                                Belum ada sesi layanan tersedia.
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
            <div class="workers-container">
                <div class="workers-card-header" onclick="toggleWorkers(this)" style="cursor: pointer;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <strong>Pekerja</strong>
                        <img src="https://www.svgrepo.com/show/522029/chevron-down.svg" alt="Toggle" class="toggle-icon" style="width: 20px; height: 20px; filter: invert(100%);">
                    </div>
                </div>
                <div class="workers-card-content">
                    <div class="workers-grid">
                        {% for worker in enrolled_workers %}
                            {% if forloop.counter0|divisibleby:3 %}
                            <div class="workers-row">
                            {% endif %}
                                <div class="worker-item" onclick="window.location.href='/profile/{{ worker.nama|cut:' ' }}/'">
                                    <div class="worker-info">
                                        {% if worker.foto_url %}
                                            <img src="{{ worker.foto_url }}" alt="{{ worker.nama }}" class="worker-photo">
                                        {% else %}
                                            <img src="https://www.svgrepo.com/show/384674/account-avatar-profile-user-11.svg" alt="Default Profile" class="worker-photo">
                                        {% endif %}
                                        <div class="workers-name">{{ worker.nama }}</div>
                                    </div>
                                </div>
                            {% if forloop.counter|divisibleby:3 or forloop.last %}
                             </div>
                            {% endif %}
                        {% empty %}
                            <div class="no-workers">
                                Belum ada pekerja yang terdaftar.
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
            <div class="reviews-container">
                <div class="reviews-card-header" onclick="toggleReviews(this)" style="cursor: pointer;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <strong>Testimoni</strong>
                        <img src="https://www.svgrepo.com/show/522029/chevron-down.svg" alt="Toggle" class="toggle-icon" style="width: 20px; height: 20px; filter: invert(100%);">
                    </div>
                </div>
                <div class="reviews-card-content">
                    <div class="reviews-grid">
                        {% for testimoni in testimonials %}
                            {% with row_start=forloop.counter0|default:0 %}
                            {% if row_start|divisibleby:3 %}
                                <div class="reviews-row">
                            {% endif %}
                                <div class="reviews-item">
                                    <div class="reviews-info">
                                        <div class="review-header">
                                            <div class="reviewer-name">{{ testimoni.nama_pelanggan }}</div>
                                            <div class="review-date">{{ testimoni.tanggal }}</div>
                                        </div>
                                        <div class="rating">
                                            {% with star_rating=testimoni.star_rating %}
                                                {% for i in "12345" %}
                                                    {% with current_star=forloop.counter|stringformat:"s" %}
                                                        {% if star_rating >= current_star|add:"0" %}
                                                            <!-- Full star -->
                                                            <img src="https://www.svgrepo.com/show/513354/star.svg" alt="star" class="star-icon full">
                                                        {% elif star_rating >= current_star|add:"-0.5" %}
                                                            <!-- Half star -->
                                                            <img src="https://www.svgrepo.com/show/418904/half-star-shape.svg" alt="half star" class="star-icon half">
                                                        {% else %}
                                                            <!-- Empty star -->
                                                            <img src="https://www.svgrepo.com/show/513354/star.svg" alt="star" class="star-icon empty">
                                                        {% endif %}
                                                    {% endwith %}
                                                {% endfor %}
                                            {% endwith %}
                                            <span class="rating-number">({{ testimoni.rating }}/10)</span>
                                        </div>
                                        <div class="review-text">{{ testimoni.komentar }}</div>
                                    </div>
                                </div>
                            {% if forloop.counter|divisibleby:3 or forloop.last %}
                                </div>
                            {% endif %}
                            {% endwith %}
                        {% empty %}
                            <div class="no-reviews">
                                Belum ada testimoni untuk subkategori ini.
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<style>
    body {
        padding-top: 70px; /* Adjust this value based on the height of your navbar */
    }

    button {
        outline: none;
    }

    .subcategory-content {
        padding: 20px;
        margin-top: 20px;
    }

    .navigation-buttons {
        display: flex;
        margin-bottom: 20px;
    }

    .navigation-button {
        padding: 0.3rem 0.8rem;
        border-radius: 2rem;
        background-color: #e9f0f1;
        width: fit-content;
        display: flex;
        flex-direction: row;
        border: none;
    }

    .subcategory-container {
        padding: 30px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: stretch;
        background-color: #e9f0f1;
        border-radius: 0.5rem;
        min-height: 60vh;
        gap: 2rem;
        width: 100%;
    }

    .subcategory-container-content {
        width: 100%;
        display: flex;
        justify-content: stretch;
    }

    .sub-info {
        padding: 10px;
        display: flex;
        flex-direction: row;
        align-items: flex-start;
        justify-content: space-between;
        gap: 4rem;
        width: 100%;
    }

    .subcategory-picture {
        border-radius: 0.5rem;
        overflow: hidden;
        flex: 0 0 45%;
        aspect-ratio: 16/9;
    }

    .subcategory-picture img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .subcategory-name h1 {
        font-size: 75px;
        font-weight: bold;
    }

    .mini-infos {
        display: flex;
        gap: 0.5rem;
    }

    .mini-info {
        padding: 0.3rem 0.8rem;
        border-radius: 2rem;
        background-color: #f8f9fa;
        width: fit-content;
        display: flex;
        flex-direction: row;
        gap: 0.5rem;
    }

    .horizontal-stack-info {
        gap: 0.5rem;
        display: flex;
        align-items: center;
    }

    .category-info, .home {
        display: flex;
        align-items: center;
    }

    .subcategory-description {
        padding: 20px;
        display: flex;
        flex-direction: column;
        background-color: #cdddde;
        border-radius: 0.5rem;
        margin-top: 0.5rem;
    }

    .subcategory-main-info {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }

    .join-sub, .order-session {
        padding: 0.5rem 1rem;
        border-radius: 2rem;
        background-color: #177E89;
        color: white;
        width: fit-content;
        border: none;
    }

    .join-sub:hover, .order-session:hover {
        background-color: #084c61;
    }

    .addts {
        gap: 0.75rem;
    }

    .session-container, .workers-container, .reviews-container {
        padding: 10px;
        width: 100%;
        display: flex;
        flex-direction: column;
    }

    .session-card-header, .workers-card-header, .reviews-card-header {
        padding: 10px 20px;
        margin-bottom: 0;
        background-color:#177E89;
        color: white;
        border-radius: 0.5rem;
        font-size: 16px;
        width: 100%;
        transition: border-radius 0.3s ease;
    }

    .session-card-header.collapsed, .workers-card-header.collapsed, .reviews-card-header.collapsed {
        border-radius: 0.5rem;
    }

    .session-card-header:not(.collapsed), .workers-card-header:not(.collapsed), .reviews-card-header:not(.collapsed) {
        border-radius: 0.5rem 0.5rem 0 0;
    }

    .session-card-content, .workers-card-content, .reviews-card-content {
        padding: 20px;
        margin-bottom: 0;
        background-color:#cdddde;
        border-radius: 0 0 0.5rem 0.5rem;
        font-size: 16px;
        width: 100%;
        display: block;
        transition: all 0.3s ease;
    }

    .session-card-content.hidden, .workers-card-content.hidden, .reviews-card-content.hidden {
        display: none;
    }

    .toggle-icon {
        transition: transform 0.3s ease;
    }

    .collapsed .toggle-icon {
        transform: rotate(-180deg);
    }

    .sessions-grid {
        width: 100%;
        gap: 0.5rem;
        display: flex;
        flex-direction: column;
    }

    .sessions-row {
        display: flex;
        justify-content: flex-start;
        gap: 20px;
    }

    .session-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1rem;
        background-color: #F5F5F5;
        border-radius: 0.5rem;
        width: 100%;
    }

    .session-info {
        display: flex;
        flex-direction: column;
        gap: 0.25rem;
    }

    .session-number {
        font-weight: bold;
        color: #177E89;
    }

    .session-price {
        font-weight: bold;
    }

    .reviews-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 20px;
    }

    .reviews-item {
        background: #fff;
        border-radius: 8px;
        padding: 16px;
        width: 100%;
        height: 100%;
    }

    .reviews-info {
        display: flex;
        flex-direction: column;
        gap: 12px;
    }

    .review-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .reviewer-name {
        font-weight: 600;
        color: #333;
    }

    .review-date {
        color: #666;
        font-size: 0.9rem;
    }

    .rating {
        display: flex;
        align-items: center;
        gap: 4px;
    }

    .rating-number {
        margin-left: 8px;
        color: #666;
        font-size: 0.9rem;
    }

    .review-text {
        color: #444;
        line-height: 1.5;
        margin-top: 8px;
    }

    .star-icon {
        width: 18px;
        height: 18px;
    }
    
    .star-icon.full {
        filter: invert(71%) sepia(99%) saturate(387%) hue-rotate(358deg) brightness(103%) contrast(105%);
    }
    
    .star-icon.half {
        filter: invert(71%) sepia(99%) saturate(387%) hue-rotate(358deg) brightness(103%) contrast(105%);
    }
    
    .star-icon.empty {
        filter: invert(88%) sepia(6%) saturate(111%) hue-rotate(169deg) brightness(88%) contrast(85%);
    }

    .no-reviews {
        text-align: center;
        padding: 2rem;
        color: #666;
        background: white;
        border-radius: 0.5rem;
    }

    .p_buttons {
        margin-left: auto;
    }

    .join-sub, .order-session {
        padding: 0.5rem 1rem;
        border-radius: 2rem;
        background-color: #177E89;
        color: white;
        width: fit-content;
        border: none;
        cursor: pointer;
        font-size: 0.9rem;
    }

    .no-sessions {
        width: 100%;
        text-align: center;
        padding: 20px;
        color: #666;
    }

    .workers-grid {
        width: 100%;
        gap: 0.5rem;
        display: flex;
        flex-direction: column;
    }

    .workers-row {
        display: flex;
        justify-content: flex-start;
        gap: 20px;
    }

    .worker-item {
        flex: 0 0 calc(33.33% - 15px);
        background: white;
        border-radius: 8px;
        padding: 8px;
        cursor: pointer;
    }

    .worker-info {
        display: flex;
        flex-direction: row;
        align-items: center;
        gap: 10px;
        padding: 8px;
    }

    .worker-photo {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        object-fit: cover;
        margin: 0;
    }

    .workers-name {
        font-weight: bold;
        color: #177E89;
        margin: 0;
    }

    .no-workers {
        width: 100%;
        text-align: center;
        padding: 20px;
        color: #666;
    }
</style>
<script>
    function toggleSessions(header) {
        const content = header.nextElementSibling;
        header.classList.toggle('collapsed');
        content.classList.toggle('hidden');
    }

    function toggleWorkers(header) {
        const content = header.nextElementSibling;
        header.classList.toggle('collapsed');
        content.classList.toggle('hidden');
    }

    function toggleReviews(header) {
        const content = header.nextElementSibling;
        header.classList.toggle('collapsed');
        content.classList.toggle('hidden');
    }
</script>
<script>
    document.querySelectorAll('.order-session').forEach(button => {
        button.addEventListener('click', function() {
            const sessionText = this.closest('.session-item').querySelector('.session-number').textContent;
            const sessionNumber = sessionText.split(' ')[0];  
            window.location.href = `/pemesanan-jasa/${subcategory.nama_subkategori|cut:' ' }?selected_session=${sessionNumber}`;
        });
    });
</script>
{% endblock %}
